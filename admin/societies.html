<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Master Admin - Manage Societies</title>
    <meta name="description" content="Master admin panel for managing golf societies." />
    <link rel="stylesheet" href="../assets/css/style.css" />
    <style>
      :root {
        --admin-primary: #2dc26b;
        --admin-primary-hover: #25a85a;
        --admin-border: #e0e0e0;
        --admin-bg: #fafafa;
      }
      .admin-container {
        max-width: 1200px;
        margin: 2em auto;
        padding: 2em;
      }
      .admin-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        align-items: center;
        gap: 1em;
        margin-bottom: 2em;
        padding-bottom: 1em;
        border-bottom: 2px solid var(--admin-primary);
      }
      .btn {
        padding: 0.5em 1.25em;
        min-height: 2.5rem;
        background: var(--admin-primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: background 0.2s, transform 0.1s;
        text-decoration: none;
        display: inline-block;
        box-sizing: border-box;
      }
      .btn:hover {
        background: var(--admin-primary-hover);
      }
      .btn:active {
        transform: scale(0.98);
      }
      .btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }
      .btn-secondary {
        background: #555;
      }
      .btn-secondary:hover {
        background: #444;
      }
      .btn-secondary:disabled:hover {
        background: #555;
      }
      .btn-danger {
        background: #c33;
      }
      .btn-danger:hover {
        background: #a22;
      }
      .btn-danger:disabled:hover {
        background: #c33;
      }
      .btn-sm {
        padding: 0.4em 0.9em;
        min-height: 2rem;
        font-size: 0.875rem;
      }
      .btn-link {
        background: none;
        color: var(--admin-primary);
        padding: 0.25em 0;
      }
      .btn-link:hover {
        background: none;
        text-decoration: underline;
      }
      .societies-scroll {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin-top: 1em;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }
      .societies-table {
        width: 100%;
        min-width: 720px;
        border-collapse: collapse;
        background: white;
      }
      .societies-table th,
      .societies-table td {
        padding: 0.85em 1em;
        text-align: left;
        border-bottom: 1px solid var(--admin-border);
      }
      .societies-table th {
        background: var(--admin-bg);
        font-weight: 600;
        color: #333;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 1;
      }
      .societies-table tbody tr:hover {
        background: #f5fbf7;
      }
      .societies-table .col-id {
        font-weight: 600;
        color: #333;
      }
      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5em;
        align-items: center;
      }
      .actions .btn {
        white-space: nowrap;
        margin: 0;
      }
      .actions .btn-secondary {
        min-width: 5em;
      }
      /* Card layout for small screens */
      .societies-cards {
        display: none;
      }
      @media (max-width: 768px) {
        .societies-scroll {
          display: none;
        }
        .societies-cards {
          display: block;
        }
        .society-card {
          background: white;
          border: 1px solid var(--admin-border);
          border-radius: 8px;
          padding: 1.25em;
          margin-bottom: 1em;
          box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .society-card__row {
          display: flex;
          justify-content: space-between;
          gap: 0.5em;
          margin-bottom: 0.5em;
          font-size: 0.95em;
        }
        .society-card__row:last-of-type {
          margin-bottom: 0;
        }
        .society-card__label {
          color: #666;
          flex-shrink: 0;
        }
        .society-card__value {
          font-weight: 500;
          text-align: right;
        }
        .society-card__title {
          font-weight: 700;
          color: #333;
          margin-bottom: 0.75em;
          font-size: 1.05em;
        }
        .society-card__actions {
          display: flex;
          flex-wrap: wrap;
          gap: 0.5em;
          align-items: center;
          margin-top: 1em;
          padding-top: 1em;
          border-top: 1px solid var(--admin-border);
        }
        .society-card__actions .btn {
          margin: 0;
        }
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.45);
        overflow: auto;
        padding: 1em;
        box-sizing: border-box;
      }
      .modal.is-open {
        display: flex;
        align-items: flex-start;
        justify-content: center;
      }
      .modal-content {
        background: white;
        margin: 2vh auto;
        padding: 2em;
        border-radius: 10px;
        max-width: 560px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5em;
        padding-bottom: 1em;
        border-bottom: 1px solid var(--admin-border);
      }
      .modal-header h2 {
        margin: 0;
        color: var(--admin-primary);
        font-size: 1.35rem;
      }
      .close {
        color: #888;
        font-size: 1.75rem;
        line-height: 1;
        cursor: pointer;
        border: none;
        background: none;
        padding: 0.25em;
        width: 36px;
        height: 36px;
        border-radius: 6px;
        transition: background 0.2s, color 0.2s;
      }
      .close:hover {
        color: #000;
        background: #eee;
      }
      .form-group {
        margin-bottom: 1.35em;
      }
      .form-group label {
        display: block;
        margin-bottom: 0.4em;
        font-weight: 600;
        color: #333;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.65em 0.85em;
        border: 1px solid var(--admin-border);
        border-radius: 6px;
        font-size: 1em;
        box-sizing: border-box;
      }
      .form-group textarea {
        min-height: 100px;
        resize: vertical;
        font-family: inherit;
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--admin-primary);
        box-shadow: 0 0 0 2px rgba(45, 194, 107, 0.2);
      }
      .form-group small {
        display: block;
        margin-top: 0.35em;
        color: #666;
        font-size: 0.875rem;
      }
      .form-actions {
        display: flex;
        flex-wrap: nowrap;
        align-items: stretch;
        justify-content: flex-start;
        gap: 0.75em;
        margin-top: 1.75em;
        padding-top: 1.25em;
        border-top: 1px solid var(--admin-border);
      }
      .form-actions__spacer {
        flex: 1;
        min-width: 0.5rem;
      }
      .form-actions .btn {
        height: 2.5rem;
        min-height: 2.5rem;
        padding: 0 1.25em;
        font-size: 1rem;
        flex-shrink: 0;
        min-width: 6em;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
      }
      @media (max-width: 480px) {
        .form-actions {
          gap: 0.5em;
        }
        .form-actions .btn.btn-danger,
        .form-actions .btn.btn-secondary {
          min-width: 4.5em;
          padding: 0 0.6em;
          font-size: 0.9rem;
        }
        .form-actions .btn:not(.btn-danger):not(.btn-secondary) {
          min-width: 5em;
          padding: 0 0.75em;
          font-size: 0.9rem;
        }
      }
      @media (max-width: 420px) {
        .form-actions {
          flex-direction: column;
          align-items: stretch;
          gap: 0.5em;
        }
        .form-actions .btn {
          min-width: 0;
          width: 100%;
        }
        .form-actions__spacer {
          display: none;
        }
      }
      .btn.is-saving {
        pointer-events: none;
        opacity: 0.85;
      }
      .btn.is-saving::after {
        content: '';
        display: inline-block;
        width: 1em;
        height: 1em;
        margin-left: 0.5em;
        vertical-align: middle;
        border: 2px solid rgba(255,255,255,0.5);
        border-top-color: #fff;
        border-radius: 50%;
        animation: society-spin 0.6s linear infinite;
      }
      @keyframes society-spin {
        to { transform: rotate(360deg); }
      }
      .alert {
        padding: 0.9em 1.2em;
        margin: 0 0 1em 0;
        border-radius: 6px;
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 1em;
      }
      .alert-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .alert-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .alert-dismiss {
        background: none;
        border: none;
        color: inherit;
        opacity: 0.8;
        cursor: pointer;
        padding: 0 0.25em;
        font-size: 1.25em;
        line-height: 1;
      }
      .alert-dismiss:hover {
        opacity: 1;
      }
      .loading {
        text-align: center;
        padding: 3em;
        color: #666;
      }
      .empty-state {
        text-align: center;
        padding: 3em 2em;
        color: #666;
        background: var(--admin-bg);
        border-radius: 8px;
        border: 1px dashed var(--admin-border);
      }
      .empty-state p {
        margin: 0 0 1em 0;
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0,0,0,0);
        white-space: nowrap;
        border: 0;
      }
      .admin-hero-top {
        margin-top: 0;
        position: relative;
      }
      .admin-hero-logo {
        position: absolute;
        top: 0.75rem;
        left: 0.75rem;
        z-index: 2;
      }
      .admin-hero-logo a {
        display: block;
      }
      .admin-hero-logo img {
        display: block;
        height: 2.5rem;
        width: auto;
      }
    </style>
  </head>
  <body>
    <div class="hero hero--banner admin-hero-top">
      <div class="admin-hero-logo">
        <a href="../index.html">
          <img src="../assets/images/TGA.png" alt="TGA" width="80" height="40" />
        </a>
      </div>
      <figure class="hero__image">
        <div class="hero__image-wrapper">
          <img src="../assets/images/golfBanner.jpg" loading="eager" alt="Golf course" />
        </div>
      </figure>
      <header class="hero__content hero__content--overlay">
        <div class="wrapper">
          <h1>Manage Societies</h1>
        </div>
      </header>
    </div>
    <main class="page">
      <article class="content">
        <div class="entry-wrapper content__entry">
        <div class="admin-container">
          <div class="admin-header">
            <button class="btn" onclick="openCreateModal()">+ Add New Society</button>
          </div>

          <div id="alert-container"></div>

          <div id="societies-container">
            <div class="loading">Loading societies...</div>
          </div>
          <div id="societies-cards" class="societies-cards"></div>
        </div>
        </div>
      </article>
    </main>

    <!-- Create/Edit Society Modal -->
    <div id="societyModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
      <div class="modal-content" role="document">
        <div class="modal-header">
          <h2 id="modalTitle">Add New Society</h2>
          <button type="button" class="close" onclick="closeModal()" aria-label="Close">&times;</button>
        </div>
        <p id="modalDesc" class="sr-only">Add or edit society details.</p>
        <form id="societyForm" onsubmit="saveSociety(event)">
          <input type="hidden" id="editSocietyId" value="">
          
          <div class="form-group">
            <label for="societyId">Society ID *</label>
            <input type="text" id="societyId" required 
                   pattern="[a-z0-9-]+" 
                   placeholder="e.g., bushwhackers"
                   title="Lowercase letters, numbers, and hyphens only">
            <small style="color: #666;">Used in URL: /theGolfApp/{society-id}/</small>
          </div>

          <div class="form-group">
            <label for="societyName">Society Name *</label>
            <input type="text" id="societyName" required 
                   placeholder="e.g., Bushwhackers @ the Botanic">
          </div>

          <div class="form-group">
            <label for="contactPerson">Contact Person *</label>
            <input type="text" id="contactPerson" required 
                   placeholder="e.g., John Doe">
          </div>

          <div class="form-group">
            <label for="numberOfPlayers">Number of Players</label>
            <input type="number" id="numberOfPlayers" min="0" value="0">
          </div>

          <div class="form-group">
            <label for="numberOfCourses">Number of Courses</label>
            <input type="number" id="numberOfCourses" min="0" value="0">
          </div>

          <div class="form-group">
            <label for="nextOuting">Next Outing</label>
            <input type="text" id="nextOuting" placeholder="e.g. 1 or next outing reference">
            <small style="color: #666;">Reference or identifier for the next outing</small>
          </div>

          <div class="form-group">
            <label for="captainsNotes">Captain's Notes</label>
            <textarea id="captainsNotes" rows="5" placeholder="Multi-line notes from the captain (like Editor's Notes in BGS). You can use line breaks and simple formatting."></textarea>
            <small style="color: #666;">Multi-line field; line breaks are preserved. Optional **bold** and *italic* when displayed.</small>
          </div>

          <div class="form-group" id="statusGroup" style="display: none;">
            <label for="status">Status</label>
            <select id="status">
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-danger" id="societyFormDelete" onclick="deleteSocietyFromModal()" style="display: none;">Delete</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal()" id="societyFormCancel">Cancel</button>
            <span class="form-actions__spacer" aria-hidden="true"></span>
            <button type="submit" class="btn" id="societyFormSubmit">Save Society</button>
          </div>
        </form>
      </div>
    </div>

    <footer class="footer">
      <div class="wrapper">
        <div class="footer__copyright">
          <p><span style="color: #169179;">Master Admin Panel</span></p>
        </div>
      </div>
    </footer>

    <script src="../assets/js/config/app-config.js"></script>
    <script src="../assets/js/utils/api-client.js"></script>
    <script>
      let societies = [];
      let editingSociety = null;

      // Load all societies
      async function loadSocieties() {
        const container = document.getElementById('societies-container');
        const cardsContainer = document.getElementById('societies-cards');

        try {
          const result = await ApiClient.get({ action: 'getAllSocieties' });

          if (result.success) {
            societies = result.societies || [];
            renderSocieties();
          } else {
            showAlert('error', 'Failed to load societies: ' + (result.error || 'Unknown error'));
            container.innerHTML = '<div class="empty-state">Error loading societies.</div>';
            cardsContainer.innerHTML = '';
          }
        } catch (error) {
          console.error('Error loading societies:', error);
          showAlert('error', 'Error loading societies: ' + error.message);
          container.innerHTML = '<div class="empty-state">Error loading societies.</div>';
          cardsContainer.innerHTML = '';
        }
      }

      // Render societies table and cards
      function renderSocieties() {
        const container = document.getElementById('societies-container');
        const cardsContainer = document.getElementById('societies-cards');

        if (societies.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No societies yet.</p><p><button type="button" class="btn" onclick="openCreateModal()">Add New Society</button></p></div>';
          cardsContainer.innerHTML = '';
          return;
        }

        function escJs(s) {
          return String(s).replace(/\\/g, '\\\\').replace(/'/g, "\\'");
        }
        const tableHtml = societies.map(society => {
          const status = society.status || 'Active';
          const sidDisplay = escapeHtml(society.societyId);
          const sidJs = escJs(society.societyId);
          const manageUrl = 'society-admin.html?societyId=' + encodeURIComponent(society.societyId);
          let actions = '<a href="' + manageUrl + '" class="btn btn-secondary btn-sm">Manage</a> ';
          actions += '<button type="button" class="btn btn-secondary btn-sm" onclick="editSociety(\'' + sidJs + '\')">Edit</button>';
          if (status !== 'Active') {
            actions += ' <button type="button" class="btn btn-sm" onclick="activateSociety(\'' + sidJs + '\')">Activate</button>';
          }
          return '<tr>' +
            '<td class="col-id">' + sidDisplay + '</td>' +
            '<td>' + escapeHtml(decodeFormSpaces(society.societyName)) + '</td>' +
            '<td>' + escapeHtml(decodeFormSpaces(society.contactPerson)) + '</td>' +
            '<td>' + (society.numberOfPlayers || 0) + '</td>' +
            '<td>' + (society.numberOfCourses || 0) + '</td>' +
            '<td>' + escapeHtml(decodeFormSpaces(society.nextOuting)) + '</td>' +
            '<td>' + escapeHtml(society.createdDate || '') + '</td>' +
            '<td class="actions">' + actions + '</td></tr>';
        }).join('');

        container.innerHTML = '<div class="societies-scroll"><table class="societies-table">' +
          '<thead><tr>' +
          '<th>Society ID</th><th>Society Name</th><th>Contact</th><th>Players</th><th>Courses</th><th>Next Outing</th><th>Created</th><th>Actions</th>' +
          '</tr></thead><tbody>' + tableHtml + '</tbody></table></div>';

        const cardsHtml = societies.map(society => {
          const status = society.status || 'Active';
          const sidJs = escJs(society.societyId);
          const manageUrl = 'society-admin.html?societyId=' + encodeURIComponent(society.societyId);
          return '<div class="society-card">' +
            '<div class="society-card__title">' + escapeHtml(decodeFormSpaces(society.societyName) || society.societyId) + '</div>' +
            '<div class="society-card__row"><span class="society-card__label">Contact</span><span class="society-card__value">' + escapeHtml(decodeFormSpaces(society.contactPerson) || '—') + '</span></div>' +
            '<div class="society-card__row"><span class="society-card__label">Players / Courses</span><span class="society-card__value">' + (society.numberOfPlayers || 0) + ' / ' + (society.numberOfCourses || 0) + '</span></div>' +
            '<div class="society-card__actions">' +
            '<a href="' + manageUrl + '" class="btn btn-secondary btn-sm">Manage</a> ' +
            '<button type="button" class="btn btn-secondary btn-sm" onclick="editSociety(\'' + sidJs + '\')">Edit</button>' +
            (status !== 'Active' ? ' <button type="button" class="btn btn-sm" onclick="activateSociety(\'' + sidJs + '\')">Activate</button>' : '') +
            '</div></div>';
        }).join('');
        cardsContainer.innerHTML = cardsHtml;
      }

      // Open create modal
      function openCreateModal() {
        editingSociety = null;
        document.getElementById('modalTitle').textContent = 'Add New Society';
        document.getElementById('societyForm').reset();
        document.getElementById('editSocietyId').value = '';
        document.getElementById('societyId').disabled = false;
        document.getElementById('statusGroup').style.display = 'none';
        document.getElementById('societyFormDelete').style.display = 'none';
        const modal = document.getElementById('societyModal');
        modal.classList.add('is-open');
        document.body.style.overflow = 'hidden';
        setTimeout(function() {
          const first = document.getElementById('societyId');
          if (first) first.focus();
        }, 50);
      }

      // Edit society
      function editSociety(societyId) {
        const society = societies.find(s => s.societyId === societyId);
        if (!society) {
          showAlert('error', 'Society not found');
          return;
        }

        editingSociety = society;
        document.getElementById('modalTitle').textContent = 'Edit Society';
        document.getElementById('editSocietyId').value = societyId;
        document.getElementById('societyId').value = societyId;
        document.getElementById('societyId').disabled = true;
        document.getElementById('societyName').value = decodeFormSpaces(society.societyName) || '';
        document.getElementById('contactPerson').value = decodeFormSpaces(society.contactPerson) || '';
        document.getElementById('numberOfPlayers').value = society.numberOfPlayers || 0;
        document.getElementById('numberOfCourses').value = society.numberOfCourses || 0;
        document.getElementById('nextOuting').value = decodeFormSpaces(society.nextOuting) || '';
        document.getElementById('captainsNotes').value = decodeFormSpaces(society.captainsNotes) || '';
        document.getElementById('status').value = society.status || 'Active';
        document.getElementById('statusGroup').style.display = 'block';
        document.getElementById('societyFormDelete').style.display = 'inline-block';
        const modal = document.getElementById('societyModal');
        modal.classList.add('is-open');
        document.body.style.overflow = 'hidden';
        setTimeout(function() {
          const first = document.getElementById('societyName');
          if (first) first.focus();
        }, 50);
      }

      // Close modal
      function closeModal() {
        document.getElementById('societyModal').classList.remove('is-open');
        document.body.style.overflow = '';
        editingSociety = null;
      }

      // Delete society from the Edit dialog (removes row from sheet)
      async function deleteSocietyFromModal() {
        if (!editingSociety || !editingSociety.societyId) return;
        const societyId = editingSociety.societyId;
        if (!confirm('Are you sure you want to delete "' + societyId + '"? This will remove the society from the sheet.')) {
          return;
        }
        const deleteBtn = document.getElementById('societyFormDelete');
        const submitBtn = document.getElementById('societyFormSubmit');
        const cancelBtn = document.getElementById('societyFormCancel');
        deleteBtn.disabled = true;
        submitBtn.disabled = true;
        cancelBtn.disabled = true;
        try {
          const result = await ApiClient.post('deleteSociety', { societyId: societyId });
          if (result && result.success) {
            showAlert('success', 'Society deleted successfully');
            closeModal();
            loadSocieties();
          } else {
            showAlert('error', 'Failed to delete society: ' + (result && result.error ? result.error : 'Unknown error'));
          }
        } catch (error) {
          console.error('Error deleting society:', error);
          showAlert('error', 'Error deleting society: ' + (error.message || String(error)));
        } finally {
          deleteBtn.disabled = false;
          submitBtn.disabled = false;
          cancelBtn.disabled = false;
        }
      }

      // Save society (create or update)
      async function saveSociety(event) {
        event.preventDefault();

        const societyId = document.getElementById('societyId').value.trim().toLowerCase();
        const societyName = document.getElementById('societyName').value.trim();
        const contactPerson = document.getElementById('contactPerson').value.trim();
        const numberOfPlayers = parseInt(document.getElementById('numberOfPlayers').value) || 0;
        const numberOfCourses = parseInt(document.getElementById('numberOfCourses').value) || 0;
        const nextOuting = document.getElementById('nextOuting').value.trim();
        const captainsNotes = document.getElementById('captainsNotes').value.trim();
        const status = document.getElementById('status').value || 'Active';

        if (!/^[a-z0-9-]+$/.test(societyId)) {
          showAlert('error', 'Society ID must contain only lowercase letters, numbers, and hyphens');
          return;
        }

        const submitBtn = document.getElementById('societyFormSubmit');
        const cancelBtn = document.getElementById('societyFormCancel');
        const payload = {
          societyId: societyId,
          societyName: societyName,
          contactPerson: contactPerson,
          numberOfPlayers: numberOfPlayers,
          numberOfCourses: numberOfCourses,
          nextOuting: nextOuting,
          captainsNotes: captainsNotes
        };

        submitBtn.disabled = true;
        cancelBtn.disabled = true;
        submitBtn.classList.add('is-saving');
        submitBtn.textContent = 'Saving…';

        try {
          const action = editingSociety ? 'updateSociety' : 'createSociety';
          if (editingSociety) {
            payload.status = status;
          }
          const result = await ApiClient.post(action, payload);

          if (result && result.success) {
            showAlert('success', editingSociety ? 'Society updated successfully' : 'Society created successfully');
            closeModal();
            loadSocieties();
          } else {
            showAlert('error', 'Failed to save society: ' + (result && result.error ? result.error : 'Unknown error'));
          }
        } catch (error) {
          console.error('Error saving society:', error);
          showAlert('error', 'Error saving society: ' + (error.message || String(error)));
        } finally {
          submitBtn.disabled = false;
          cancelBtn.disabled = false;
          submitBtn.classList.remove('is-saving');
          submitBtn.textContent = 'Save Society';
        }
      }

      // Delete society (removes row from sheet)
      async function deleteSociety(societyId) {
        if (!confirm('Are you sure you want to delete "' + societyId + '"? This will remove the society from the sheet.')) {
          return;
        }

        try {
          const result = await ApiClient.post('deleteSociety', {
            societyId: societyId
          });

          if (result.success) {
            showAlert('success', 'Society deleted successfully');
            loadSocieties();
          } else {
            showAlert('error', 'Failed to delete society: ' + (result.error || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error deleting society:', error);
          showAlert('error', 'Error deleting society: ' + error.message);
        }
      }

      // Activate society
      async function activateSociety(societyId) {
        try {
          const result = await ApiClient.post('updateSociety', {
            societyId: societyId,
            status: 'Active'
          });

          if (result.success) {
            showAlert('success', 'Society activated successfully');
            loadSocieties();
          } else {
            showAlert('error', 'Failed to activate society: ' + (result.error || 'Unknown error'));
          }
        } catch (error) {
          console.error('Error activating society:', error);
          showAlert('error', 'Error activating society: ' + error.message);
        }
      }

      // Show alert message (dismissible, auto-hide after 5s)
      function showAlert(type, message) {
        const container = document.getElementById('alert-container');
        const alert = document.createElement('div');
        alert.className = 'alert alert-' + type;
        alert.setAttribute('role', 'alert');
        const text = document.createElement('span');
        text.textContent = message;
        text.style.flex = '1';
        alert.appendChild(text);
        const dismiss = document.createElement('button');
        dismiss.type = 'button';
        dismiss.className = 'alert-dismiss';
        dismiss.setAttribute('aria-label', 'Dismiss');
        dismiss.textContent = '\u00D7';
        dismiss.onclick = function() { alert.remove(); };
        alert.appendChild(dismiss);
        container.innerHTML = '';
        container.appendChild(alert);
        setTimeout(function() {
          if (alert.parentNode) alert.remove();
        }, 5000);
      }

      // Decode + to space (form-encoded spaces from API/sheet)
      function decodeFormSpaces(str) {
        return (str == null || str === '') ? '' : String(str).replace(/\+/g, ' ');
      }
      // Escape HTML
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Close modal when clicking outside or pressing Escape
      document.addEventListener('click', function(event) {
        const modal = document.getElementById('societyModal');
        if (event.target === modal) {
          closeModal();
        }
      });
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const modal = document.getElementById('societyModal');
          if (modal && modal.classList.contains('is-open')) {
            closeModal();
          }
        }
      });

      // Load societies on page load
      loadSocieties();
    </script>
  </body>
</html>
